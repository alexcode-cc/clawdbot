# 開發環境設定

## 系統需求

### 必要條件

| 項目 | 版本需求 |
|------|---------|
| Node.js | >= 22.12.0 |
| pnpm | 10.23.0 |
| Git | 最新版本 |

### 選擇性（依開發目標）

| 項目 | 用途 |
|------|------|
| Bun | TypeScript 執行（推薦） |
| Xcode | iOS/macOS 應用開發 |
| Android Studio | Android 應用開發 |
| Docker | 容器化測試 |

## 快速開始

### 1. 複製專案

```bash
git clone https://github.com/moltbot/moltbot.git
cd moltbot
```

### 2. 安裝依賴

```bash
# 使用 pnpm（主要）
pnpm install

# 或使用 Bun（也支援）
bun install
```

### 3. 建置專案

```bash
pnpm build
```

### 4. 執行測試

```bash
pnpm test
```

### 5. 安裝 Git Hooks

```bash
prek install
```

## 開發命令

### CLI 開發

```bash
# 執行 CLI（開發模式）
pnpm moltbot --help
pnpm moltbot config list
pnpm moltbot agent

# 或使用 npm scripts
pnpm dev
```

### Gateway 開發

```bash
# 啟動 Gateway（開發模式）
pnpm gateway:dev

# 監視模式（自動重載）
pnpm gateway:watch

# 重置並啟動
pnpm gateway:dev:reset
```

### UI 開發

```bash
# 安裝 UI 依賴
pnpm ui:install

# 開發模式
pnpm ui:dev

# 建置
pnpm ui:build
```

### TUI 開發

```bash
# 啟動 TUI
pnpm tui

# 開發模式
pnpm tui:dev
```

## 建置命令

### TypeScript 建置

```bash
# 完整建置
pnpm build

# 僅 TypeScript 編譯
tsc -p tsconfig.json

# 監視模式
tsc -p tsconfig.json --watch
```

### 協議生成

```bash
# 生成 TypeScript 協議
pnpm protocol:gen

# 生成 Swift 協議
pnpm protocol:gen:swift

# 檢查協議一致性
pnpm protocol:check
```

### Canvas A2UI 打包

```bash
pnpm canvas:a2ui:bundle
```

## 程式碼品質

### Lint 檢查

```bash
# 執行 lint
pnpm lint

# 自動修復
pnpm lint:fix

# Swift lint
pnpm lint:swift

# 全部 lint
pnpm lint:all
```

### 格式化

```bash
# 檢查格式
pnpm format

# 自動格式化
pnpm format:fix

# Swift 格式化
pnpm format:swift

# 全部格式化
pnpm format:all
```

### 類型檢查

```bash
# 在 build 中包含
pnpm build
```

## 測試

### 單元測試

```bash
# 執行所有測試
pnpm test

# 監視模式
pnpm test:watch

# 覆蓋率報告
pnpm test:coverage

# UI 測試
pnpm test:ui
```

### E2E 測試

```bash
# E2E 測試
pnpm test:e2e

# 實時測試（需要真實 API 金鑰）
CLAWDBOT_LIVE_TEST=1 pnpm test:live
```

### Docker 測試

```bash
# 模型實時測試
pnpm test:docker:live-models

# Gateway 實時測試
pnpm test:docker:live-gateway

# Onboarding 測試
pnpm test:docker:onboard

# 網路測試
pnpm test:docker:gateway-network

# 插件測試
pnpm test:docker:plugins

# 執行所有 Docker 測試
pnpm test:docker:all

# 清理 Docker 資源
pnpm test:docker:cleanup
```

### 安裝腳本測試

```bash
# Smoke 測試
pnpm test:install:smoke

# E2E 測試
pnpm test:install:e2e

# 特定提供者
pnpm test:install:e2e:openai
pnpm test:install:e2e:anthropic
```

## 行動應用開發

### iOS

```bash
# 生成 Xcode 專案
pnpm ios:gen

# 開啟專案
pnpm ios:open

# 建置
pnpm ios:build

# 執行
pnpm ios:run
```

### Android

```bash
# 建置 Debug APK
pnpm android:assemble

# 安裝到裝置
pnpm android:install

# 建置並執行
pnpm android:run

# 執行測試
pnpm android:test
```

### macOS

```bash
# 打包應用程式
pnpm mac:package

# 開啟應用程式
pnpm mac:open

# 重啟
pnpm mac:restart
```

## 文件開發

### 本地預覽

```bash
# 安裝 Mintlify CLI
npm i -g mintlify

# 啟動開發伺服器
pnpm docs:dev
```

### 檢查連結

```bash
pnpm docs:build
```

## 環境變數

### 開發用環境變數

| 變數 | 說明 |
|------|------|
| `CLAWDBOT_CONFIG_PATH` | 配置檔路徑 |
| `CLAWDBOT_PROFILE` | 配置檔案名稱（如 `dev`） |
| `CLAWDBOT_LOG_LEVEL` | 日誌等級（debug, info, warn, error） |
| `CLAWDBOT_SKIP_CHANNELS` | 跳過頻道載入（加速開發） |
| `CLAWDBOT_LIVE_TEST` | 啟用實時測試 |
| `CLAWDBOT_DEBUG` | 除錯模式 |

### 設定範例

```bash
# .env.local（不要提交）
CLAWDBOT_PROFILE=dev
CLAWDBOT_LOG_LEVEL=debug
CLAWDBOT_SKIP_CHANNELS=1
```

## IDE 設定

### VS Code / Cursor

推薦擴充套件：
- ESLint
- Prettier
- TypeScript and JavaScript Language Features
- Vitest

### 設定檔

```json
// .vscode/settings.json
{
  "editor.formatOnSave": true,
  "editor.defaultFormatter": "esbenp.prettier-vscode",
  "typescript.tsdk": "node_modules/typescript/lib"
}
```

## 故障排除

### 常見問題

#### pnpm install 失敗

```bash
# 清除快取
pnpm store prune

# 重新安裝
rm -rf node_modules pnpm-lock.yaml
pnpm install
```

#### TypeScript 編譯錯誤

```bash
# 清除建置產物
rm -rf dist

# 重新建置
pnpm build
```

#### 測試失敗

```bash
# 執行特定測試
pnpm test src/path/to/file.test.ts

# 詳細輸出
pnpm test -- --reporter=verbose
```

### 取得幫助

1. 查看 [官方文件](https://docs.molt.bot)
2. 搜尋 [GitHub Issues](https://github.com/moltbot/moltbot/issues)
3. 加入 [Discord 社群](https://discord.gg/qkhbAGHRBT)

## 版本發布

### 發布檢查清單

```bash
# 執行發布檢查
pnpm release:check

# 詳細流程請參閱
# docs/reference/RELEASING.md
# docs/platforms/mac/release.md
```

### 版本位置

| 檔案 | 位置 |
|------|------|
| CLI | `package.json` (version) |
| Android | `apps/android/app/build.gradle.kts` |
| iOS | `apps/ios/Sources/Info.plist` |
| macOS | `apps/macos/Sources/Moltbot/Resources/Info.plist` |
